{% set blogInfo = _Blog.getBlog() %}
{% set networkData = _Network.getNetworkData() %}

{{ set(this, 'title', blogInfo.title) }}

{% set limit = 20 %}
{% set articlesArr = _Blog.getBlogFeed({'limit': limit, 'offset': 0}) %}
{% set articles = articlesArr.articles %}

{% set profileImg = false %}
{% if blogInfo.owner['media'] is defined and blogInfo.owner['media'] | length > 0 %}
    {% set profileImg = _Media.getMediaUrl(blogInfo.owner['media'], 100, 100, {radius:'max', crop: 'thumb', gravity: 'face'}) %}
{% endif %}

{% set hasBlogImage = FALSE %}
{% set blogImage = "" %}
{% if blogInfo.media['cover']['path'] is not empty %}
    {% set blogImage = blogInfo.media['cover']['path'] %}
    {% set hasBlogImage = TRUE %}
{% endif %}

<!-- used to index each article as we loop over throughout the template -->
{% set articleCount = 0 %}

{{ this.registerJs("HomeController.listing();") }}
{{ this.registerJs("HomeController.blog();") }}

<main id="main" class="blog_container blog-main" role="main">
    <div class="container-fluid">
        <section class="row">
            <div class="col-xs-12 section-header">
                <div class="row">
                    {% if blogInfo.owner != false %}
                        <div class="col-sm-2">
                            {% if profileImg %}
                                <img class="profileImage" src="{{ profileImg }}"
                                     alt="{{ blogInfo.owner.display_name }}">
                            {% endif %}
                        </div>
                        <div class="col-sm-8">
                            <h2 class="header__heading">{{ blogInfo.owner.display_name }}</h2>
                            <p>{{ blogInfo.owner.bio }}</p>
                        </div>
                        <div class="col-sm-2">
                            {% if not _User.isGuest %}
                                {% set isUserFollowingBlog = _User.isUserFollowing('user', blogInfo.owner.id) %}
                                {% if isUserFollowingBlog %}
                                    <a href="#" class="btn btnFollowUser followUser" data-guid="{{ blogInfo.owner.guid }}"
                                       data-status="unfollow">FOLLOWING
                                        -</a>
                                {% else %}
                                    <a href="#" class="btn btnFollowUser followUser" data-guid="{{ blogInfo.owner.guid }}"
                                       data-status="follow">FOLLOW
                                        +</a>
                                {% endif %}
                            {% else %}
                                <a href="#" class="btn btnFollowUser forceLoginModal">FOLLOW +</a>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="col-sm-2">
                            <img class="profileImage" src="http://via.placeholder.com/170x170" alt="John Smith">
                        </div>
                        <div class="col-sm-10">
                            <h2 class="header__heading">John Smith</h2>
                            <div class="row">
                                <div class="col-sm-9 col-xs-12">
                                    <p>Optio ipidus imillenda perferum quas simoluptur? Nam etus aut laborate ventior am
                                        ad
                                        qui
                                        sam
                                        exceped minum quis imperumque parum, si ditae repudan iminum quo dolorit
                                        doluptaque
                                        etur. </p>
                                </div>
                                <div class="col-sm-3 col-xs-12 followLink">
                                    {% if not _User.isGuest %}
                                        {% set isUserFollowingBlog = _User.isUserFollowing('user', blogInfo.owner.id) %}
                                        {% if isUserFollowingBlog %}
                                            <a href="#" class="btn btnFollowUser" data-guid="{{ blogInfo.owner.guid }}"
                                               data-status="unfollow">FOLLOWING
                                                -</a>
                                        {% else %}
                                            <a href="#" class="btn btnFollowUser" data-guid="{{ blogInfo.owner.guid }}"
                                               data-status="follow">FOLLOW
                                                +</a>
                                        {% endif %}
                                    {% else %}
                                        <a href="#" class="btn btnFollowUser forceLoginModal">FOLLOW +</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </section>

        <section class="row">
            {% if articles[articleCount] %}
                {% set articleView = [
                'card3-desktop card3-mobile',
                'card3-desktop card3-mobile',
                'card4-desktop card4-mobile',
                'card4-desktop card4-mobile',
                'card4-desktop card4-mobile',
                'card4-desktop card4-mobile',
                'card4-desktop card4-mobile',
                'card4-desktop card4-mobile',
                'card4-desktop card4-mobile',
                'card4-desktop card4-mobile'
                ] %}
                {% for key, value in articleView if articles[key] %}
                    {{ this.render('partials/_single-article.twig', {
                        article: articles[articleCount],
                        position: articleCount + 1,
                        containerClass: 'testing ' ~ value
                    }) | raw }}
                    {% set articleCount = (dev) ? articleCount : articleCount + 1 %}
                {% endfor %}
            {% endif %}
        </section>

        <section class="row miniProfiles">
            <div class="col-xs-12 section-header">
                <h2>Followed By</h2>
            </div>
            {% for t in 1..8 %}
                <div class="col-sm-3 col-xs-12 miniProfile">
                    <img class="profileImage" src="http://via.placeholder.com/170x170" alt="John Smith">
                    <h2>Name Goes here</h2>
                    <a href="#">View Profile</a>
                </div>
            {% endfor %}
        </section>
    </div>
</main>